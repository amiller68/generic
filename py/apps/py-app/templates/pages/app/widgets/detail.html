<div class="max-w-3xl"
     hx-ext="sse"
     sse-connect="/_events/widgets"
     hx-trigger="sse:widget-updated-{{ widget.id }}"
     hx-get="/app/widgets/{{ widget.id }}"
     hx-target="#main-content">
    <div class="mb-6">
        <a href="/app/widgets"
           hx-get="/app/widgets"
           hx-target="#main-content"
           hx-push-url="true"
           class="text-muted-foreground hover:text-foreground flex items-center gap-1">
            <uk-icon icon="arrow-left" class="w-4 h-4"></uk-icon>
            Back to widgets
        </a>
    </div>

    <div class="uk-card uk-card-default uk-card-body">
        <div class="flex items-start justify-between mb-6">
            <div>
                <h1 class="text-2xl font-bold">{{ widget.name }}</h1>
                <div class="flex items-center gap-2 mt-2">
                    {% if processing %}
                    <span class="uk-badge uk-badge-secondary flex items-center gap-1">
                        <span class="animate-spin inline-block w-3 h-3 border-2 border-current border-t-transparent rounded-full"></span>
                        Processing...
                    </span>
                    {% elif widget.status == 'active' %}
                    <span class="uk-badge uk-badge-success">Active</span>
                    {% elif widget.status == 'draft' %}
                    <span class="uk-badge uk-badge-secondary">Draft</span>
                    {% elif widget.status == 'archived' %}
                    <span class="uk-badge uk-badge-muted">Archived</span>
                    {% else %}
                    <span class="uk-badge">{{ widget.status }}</span>
                    {% endif %}

                    {% if widget.is_public %}
                    <span class="flex items-center gap-1 text-sm text-green-600">
                        <uk-icon icon="globe" class="w-4 h-4"></uk-icon>
                        Public
                    </span>
                    {% else %}
                    <span class="flex items-center gap-1 text-sm text-muted-foreground">
                        <uk-icon icon="lock" class="w-4 h-4"></uk-icon>
                        Private
                    </span>
                    {% endif %}
                </div>
            </div>

            {% if is_owner %}
            <div class="flex gap-2">
                {% if widget.status == 'draft' %}
                <button hx-post="/app/widgets/{{ widget.id }}/activate"
                        hx-target="#main-content"
                        class="uk-button uk-button-primary">
                    <uk-icon icon="play" class="w-4 h-4 mr-2"></uk-icon>
                    Activate
                </button>
                {% elif widget.status == 'active' %}
                <button hx-post="/app/widgets/{{ widget.id }}/archive"
                        hx-target="#main-content"
                        class="uk-button uk-button-default">
                    <uk-icon icon="archive" class="w-4 h-4 mr-2"></uk-icon>
                    Archive
                </button>
                {% endif %}

                <a href="/app/widgets/{{ widget.id }}/edit"
                   hx-get="/app/widgets/{{ widget.id }}/edit"
                   hx-target="#main-content"
                   hx-push-url="true"
                   class="uk-button uk-button-default">
                    <uk-icon icon="pencil" class="w-4 h-4 mr-2"></uk-icon>
                    Edit
                </a>
            </div>
            {% endif %}
        </div>

        {% if widget.description %}
        <div class="mb-6">
            <h3 class="text-sm font-medium text-muted-foreground mb-2">Description</h3>
            <p class="text-foreground">{{ widget.description }}</p>
        </div>
        {% endif %}

        <div class="grid grid-cols-2 gap-6 border-t pt-6">
            <div>
                <h3 class="text-sm font-medium text-muted-foreground mb-1">Priority</h3>
                <p class="text-lg font-semibold">{{ widget.priority }}</p>
            </div>
            <div>
                <h3 class="text-sm font-medium text-muted-foreground mb-1">Created</h3>
                <p>{{ widget.created_at.strftime('%B %d, %Y at %H:%M') }}</p>
            </div>
            <div>
                <h3 class="text-sm font-medium text-muted-foreground mb-1">Last Updated</h3>
                <p>{{ widget.updated_at.strftime('%B %d, %Y at %H:%M') }}</p>
            </div>
            <div>
                <h3 class="text-sm font-medium text-muted-foreground mb-1">ID</h3>
                <p class="font-mono text-sm">{{ widget.id }}</p>
            </div>
        </div>

        {% if is_owner and widget.status != 'archived' %}
        <div class="border-t mt-6 pt-6">
            <h3 class="text-sm font-medium text-muted-foreground mb-4">Actions</h3>
            {% if processing %}
            <p class="text-muted-foreground">Processing in progress... The page will update when complete.</p>
            {% else %}
            <div class="flex gap-2">
                <button hx-post="/app/widgets/{{ widget.id }}/process"
                        hx-target="#main-content"
                        class="uk-button uk-button-default inline-flex items-center gap-2">
                    <uk-icon icon="zap" class="w-4 h-4"></uk-icon>
                    <span>Process Widget</span>
                </button>
                <button hx-delete="/app/widgets/{{ widget.id }}"
                        hx-confirm="Are you sure you want to delete this widget? This cannot be undone."
                        hx-target="#main-content"
                        class="uk-button uk-button-danger inline-flex items-center gap-2">
                    <uk-icon icon="trash-2" class="w-4 h-4"></uk-icon>
                    <span>Delete</span>
                </button>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
