<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" id="widget-modal-backdrop">
    <div class="uk-card uk-card-default uk-card-body w-full max-w-lg mx-4">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold">
                {% if widget %}Edit Widget{% else %}New Widget{% endif %}
            </h2>
            <button type="button"
                    onclick="document.getElementById('widget-form-modal').innerHTML = ''"
                    class="uk-button uk-button-default uk-button-small">
                <uk-icon icon="x" class="w-4 h-4"></uk-icon>
            </button>
        </div>

        <form hx-post="{% if widget %}/_admin/widgets/{{ widget.id }}/edit{% else %}/_admin/widgets/new{% endif %}"
              hx-target="{% if widget %}#widget-{{ widget.id }}{% else %}#widgets-tbody{% endif %}"
              hx-swap="{% if widget %}outerHTML{% else %}afterbegin{% endif %}"
              hx-on::after-request="if(event.detail.successful) document.getElementById('widget-form-modal').innerHTML = ''"
              class="space-y-4">

            <div>
                <label class="uk-form-label" for="name">Name *</label>
                <input type="text"
                       name="name"
                       id="name"
                       value="{{ widget.name if widget else '' }}"
                       class="uk-input"
                       placeholder="Widget name"
                       required />
            </div>

            <div>
                <label class="uk-form-label" for="description">Description</label>
                <textarea name="description"
                          id="description"
                          class="uk-textarea"
                          rows="3"
                          placeholder="Optional description">{{ widget.description if widget and widget.description else '' }}</textarea>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="uk-form-label" for="status">Status</label>
                    <select name="status" id="status" class="uk-select">
                        {% for s in statuses %}
                        <option value="{{ s }}" {% if widget and widget.status == s %}selected{% elif not widget and s == 'draft' %}selected{% endif %}>
                            {{ s|capitalize }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label class="uk-form-label" for="priority">Priority</label>
                    <input type="number"
                           name="priority"
                           id="priority"
                           value="{{ widget.priority if widget else 0 }}"
                           class="uk-input"
                           min="0"
                           max="100" />
                </div>
            </div>

            <div class="flex items-center gap-2">
                <input type="checkbox"
                       name="is_public"
                       id="is_public"
                       class="uk-checkbox"
                       value="true"
                       {% if widget and widget.is_public %}checked{% endif %} />
                <label class="uk-form-label mb-0" for="is_public">Public (visible to all users)</label>
            </div>

            <div class="flex justify-end gap-2 pt-4 border-t border-border">
                <button type="button"
                        onclick="document.getElementById('widget-form-modal').innerHTML = ''"
                        class="uk-button uk-button-default">
                    Cancel
                </button>
                <button type="submit" class="uk-button uk-button-primary">
                    {% if widget %}Save Changes{% else %}Create Widget{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Close modal on backdrop click
    document.getElementById('widget-modal-backdrop').addEventListener('click', function(e) {
        if (e.target === this) {
            document.getElementById('widget-form-modal').innerHTML = '';
        }
    });

    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            document.getElementById('widget-form-modal').innerHTML = '';
        }
    });
</script>
