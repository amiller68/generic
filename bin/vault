#!/bin/bash

# Get the directory where this script is located
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PROJECT_ROOT="$( cd "$SCRIPT_DIR/.." && pwd )"

# Source the HCP env file if it exists
if [ -f "$PROJECT_ROOT/.env.hcp" ]; then
    source "$PROJECT_ROOT/.env.hcp"
fi

# Source the vault app env file if it exists (for py specific configs)
if [ -f "$PROJECT_ROOT/py/.env.vault" ]; then
    source "$PROJECT_ROOT/py/.env.vault"
fi

run_with_vault() {
    hcp vault-secrets run --project=${VAULT_PROJECT_ID} --app=${VAULT_APP} -- "$@"
}

read_from_vault() {
    ret=$(hcp vault-secrets secrets  open --project=${VAULT_PROJECT_ID} --app=${VAULT_APP} -- "$@")
    echo "$ret" | grep "Value:" | awk '{print $2}'
}